# Outline Server Ð² Docker

Ð­Ñ‚Ð¾Ñ‚ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ **Outline VPN Server** Ð² Ð¸Ð·Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¼ Docker-Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ð¸. ÐŸÐ¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ VPN-ÑÐµÑ€Ð²ÐµÑ€Ð° Ñ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑÐ¼Ð¸.

> âœ… ÐÐ° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾Ð±Ñ€Ð°Ð·Ð° [`quay.io/outline/shadowbox`](https://github.com/OutlineFoundation/outline-server)  
> âœ… ÐŸÐ¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ  
> âœ… ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð¼ÐµÑ‚Ñ€Ð¸Ðº Prometheus  
> âœ… Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð±ÐµÐ· `network_mode: host`

---

## ðŸ“¦ Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ

- Docker 20.10+
- Docker Compose v2.10+
- `curl`, `openssl` (Ð´Ð»Ñ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸)
- Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð½Ñ‹Ð¹ TCP/UDP Ð¿Ð¾Ñ€Ñ‚ 

---

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº

```bash
# 1. ÐšÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹
git clone https://github.com/your/outline-docker.git
cd outline-docker

# 2. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð¸ Ð·Ð°Ð¿ÑƒÑÐº
./start.sh
## Ð¸Ð»Ð¸
make install
```

Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸:
- Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð´Ð»Ñ API Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²,
- Ð¡Ð¾Ð·Ð´Ð°ÑÑ‚ ÑÐ°Ð¼Ð¾Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ð¹ TLS-ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚,
- Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ Outline Server Ð² Docker,
- Ð¡Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÑ‚ Ñ„Ð°Ð¹Ð» `data/access.txt` Ð´Ð»Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· Outline Manager.

---

## ðŸ“„ Ð¤Ð°Ð¹Ð»Ñ‹ Ð¸ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°

```
outline-docker/
â”œâ”€â”€ start.sh                 # Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°
â”œâ”€â”€ init/
â”‚   â””â”€â”€ init-outline.sh      # Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
â”œâ”€â”€ docker-compose.yml       # ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°
â”œâ”€â”€ .env                     # ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ip, Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð¸ ÑÐµÐºÑ€ÐµÑ‚Ñ‹ (Ð½Ðµ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ!)
â””â”€â”€ data/
    â”œâ”€â”€ access.txt           # Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ Outline Manager (ÑÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÑ‚Ð¾Ñ‚ JSON!)
    â””â”€â”€ persisted-state/     # Ð¿Ð¾ÑÑ‚Ð¾ÑÐ½Ð½Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ ÑÐµÑ€Ð²ÐµÑ€Ð°
```

---

## ðŸ” ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ñ‡ÐµÑ€ÐµÐ· Outline Manager

ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð²Ñ‹Ð²ÐµÐ´ÐµÑ‚ JSON-ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ:

```json
{"apiUrl":"https://Ð²Ð°Ñˆ.ip:12345/Abc123...","certSha256":"BDDBC9A4395..."}
```

1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ **Outline Manager** (desktop app),
2. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ **Â«+ Add ServerÂ»**,
3. Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ **Ð²ÐµÑÑŒ JSON Ñ†ÐµÐ»Ð¸ÐºÐ¾Ð¼** (Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ñ„Ð¸Ð³ÑƒÑ€Ð½Ñ‹Ðµ ÑÐºÐ¾Ð±ÐºÐ¸),
4. Ð“Ð¾Ñ‚Ð¾Ð²Ð¾! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ ÐºÐ»ÑŽÑ‡Ð°Ð¼Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°.

---

## ðŸ›  Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

### ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²ÐµÑ€Ð°
```bash
docker compose down
docker compose up -d
```

### ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Outline
```bash
docker compose pull shadowbox
docker compose up -d
```

> âš ï¸ Ð’ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð² `./data/persisted-state` â€” Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾.

### ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð²
```bash
docker compose logs -f shadowbox
```

---

## ðŸ”’ Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

- **API-Ð¿Ð¾Ñ€Ñ‚** Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ Ð·Ð°Ñ‰Ð¸Ñ‰Ñ‘Ð½Ð½Ð¾Ð¼Ñƒ HTTPS Ñ ÑÐ°Ð¼Ð¾Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ð¼ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð¼,
- **Ð”Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²** ÑˆÐ¸Ñ„Ñ€ÑƒÑŽÑ‚ÑÑ Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Shadowsocks (chacha20-ietf-poly1305),
- **ÐŸÐ¾ÑÑ‚Ð¾ÑÐ½Ð½Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ** Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑÑ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð¸ Ð½Ðµ Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ñ‚ Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‹ ÑÐµÑ€Ð²ÐµÑ€Ð°,
- **ÐŸÐ¾Ñ€Ñ‚Ñ‹ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾** â€” ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ Ñ€Ð¸ÑÐº ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ.

---

## ðŸ“Š ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)

Outline Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Prometheus-ÑÐµÑ€Ð²ÐµÑ€ Ð½Ð° `localhost:9090` Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°.  
Ð§Ñ‚Ð¾Ð±Ñ‹ ÑÐ¾Ð±Ð¸Ñ€Ð°Ñ‚ÑŒ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸:

1. Ð Ð°ÑÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ñ€Ð¾Ð±Ñ€Ð¾Ñ Ð¿Ð¾Ñ€Ñ‚Ð¾Ð² Ð² `docker-compose.yml`:
   ```yaml
   ports:
     - "127.0.0.1:9090:9090"
     - "127.0.0.1:9091:9091"
     - "127.0.0.1:9092:9092"
   ```
2. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² `prometheus.yml`:
   ```yaml
   - targets: ['localhost:9090', 'localhost:9091', 'localhost:9092']
   ```
3. Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´ **ID 11899** Ð² Grafana.

---

## ðŸ“ Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

- Ð­Ñ‚Ð¾Ñ‚ Ð¿Ñ€Ð¾ÐµÐºÑ‚ â€” Ð¾Ð±Ñ‘Ñ€Ñ‚ÐºÐ° Ð½Ð°Ð´ [Outline Server](https://getoutline.org), ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð¿Ð¾Ð´ [Apache License 2.0](https://github.com/Jigsaw-Code/outline-server/blob/master/LICENSE).
- Ð¡ÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ â€” open source, Ð¼Ð¾Ð³ÑƒÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾.

## ðŸ’¡ Ð’Ð°Ð¶Ð½Ð¾

- **IP Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· `ip route get 1.1.1.1`** â€” ÑÑ‚Ð¾ **Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ IP Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°**, Ð¿Ð¾ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼Ñƒ ÑÐµÑ€Ð²ÐµÑ€ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð² ÑÐµÑ‚Ð¸.
- Ð•ÑÐ»Ð¸ Ð²Ð°Ñˆ ÑÐµÑ€Ð²ÐµÑ€ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ **Ð·Ð° NAT** (Ð¾Ð±Ð»Ð°ÐºÐ¾, Ñ€Ð¾ÑƒÑ‚ÐµÑ€), ÑƒÐ±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾:
  - Ð’Ð½ÐµÑˆÐ½Ð¸Ð¹ IP Ð¿Ñ€Ð¾Ð±Ñ€Ð¾ÑˆÐµÐ½ Ð½Ð° ÑÑ‚Ð¾Ñ‚ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ IP,
  - Ð˜Ð»Ð¸ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð¾Ñ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ `.env`:  
    ```bash
    echo "PUBLIC_HOSTNAME=Ð²Ð°Ñˆ.Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹.ip" > .env
    make install
    ```
